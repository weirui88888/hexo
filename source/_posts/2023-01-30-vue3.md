---
title: vue3ç›¸å…³è®°å½•
date: 2023-01-30 21:00:57
---

# ç®€ä»‹
è¿™ä¸ªåº“ç”¨æ¥å­¦ä¹ vue3+vite3é¡¹ç›®é…ç½®

# è®°å½•
è®°å½•ä¸€äº›å­¦ä¹ vue3è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæ–¹ä¾¿åæœŸå­¦ä¹ å’Œå›é¡¾

## 1.å…³äºè‡ªå®šä¹‰ç»„ä»¶refç±»å‹å®šä¹‰çš„é—®é¢˜

å½“æˆ‘ä»¬çš„ç»„ä»¶ä½¿ç”¨äº†`<script setup>`è¯­æ³•ä¹‹åï¼Œè¯¥ç»„ä»¶ä¼šå¤„äºä¸€ä¸ªå°é—­çš„çŠ¶æ€ï¼Œé€šè¿‡refæ˜¯æ— æ³•è·å–åˆ°è¯¥ç»„ä»¶å®ä¾‹çš„ï¼Œä¸ä¼šæš´éœ²ä»»ä½•åœ¨`<script setup>`ä¸­å£°æ˜çš„ç»‘å®šã€‚æ‰€ä»¥éœ€è¦æˆ‘ä»¬ä½¿ç”¨`defineExpose`å®šä¹‰ç»„ä»¶éœ€è¦æš´éœ²å‡ºå»çš„å±æ€§ã€‚


```javascript
// Demo.vue

<template>
  <div>{{ msg }}</div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
const exposeMsg = 'this is expose msg'
const noExposeMsg = 'this is no expose msg'
defineExpose({
  exposeMsg
})
</script>
```
ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ`msg`æ˜¾ç¤ºçš„é€šè¿‡äº†`defineExpose`å¯¹å¤–æš´éœ²ï¼Œè€Œ`noExpose`å´æ²¡æœ‰æš´éœ²å‡ºå»ï¼Œæ‰€ä»¥

```javascript
// è¿™æ˜¯çˆ¶ç»„ä»¶ï¼Œå¼•ç”¨åˆšæ‰çš„Demoç»„ä»¶ï¼Œé€šè¿‡refè·å–ç»„ä»¶å®ä¾‹

<template>
  <demo ref="demoRef"></demo>
</template>

<script setup lang="ts">
import { Demo } from 'Demo.vue'
import type { Ref } from 'vue'
import { ref, onMounted } from 'vue'

type demoCtx = InstanceType<typeof Demo> // è¿™é‡Œæ˜¯ç‰¹åˆ«å¼ºè°ƒçš„åœ°æ–¹ï¼Œå¦‚æœè¿™é‡Œä¸å®šä¹‰å­ç»„ä»¶çš„ç±»å‹ï¼Œæ˜¯æ— æ³•ç›´æ¥è·å–ç»„ä»¶å®Œæ•´çš„å®ä¾‹ç±»å‹çš„ï¼Œä¼šå„ç§tsæŠ¥é”™

const demoRef = ref<null | demoCtx> = ref(null)

onMounted(() => {
  console.log(demoRef.value?.exposeMsg) // èƒ½è·å–åˆ°
  console.log(demoRef.value?.noExposeMsg) // è·å–ä¸åˆ°ï¼Œå› ä¸ºå­ç»„ä»¶æ²¡æœ‰æš´éœ²è¯¥å±æ€§
})
</script>
```

## 2.å…³äºå®šä¹‰ç»„ä»¶propçš„ä¸¤ç§æ–¹å¼

### 2.1 é€šè¿‡vue2é‚£ç§ç†Ÿæ‚‰çš„æ–¹å¼

```javascript
<script>
  // definePropså’ŒdefineEmitséƒ½ä¸éœ€è¦æ‰‹åŠ¨å¼•å…¥
  const props = defineProps({
    name: {
      type: String,
      default: 'åŒ–æ°ä¸€å‘³'
    },
    show: {
      type: Boolean,
      default: false
    }
})
</script>
```

### 2.2 é€šè¿‡tsæ³›å‹å‚æ•°å®šä¹‰ç±»å‹

```javascript
<script>
  const props = defineProps<{
    name: string
    show: boolean
    labels?: Record<string,any>[]
}>()
</script>
```

ä½†æ˜¯é€šè¿‡è¿™ç§æ–¹å¼å®šä¹‰propä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æ²¡æ³•ç»™propå±æ€§æ·»åŠ é»˜è®¤å€¼ï¼Œæ‰€ä»¥è¿˜éœ€è¦é…åˆ`withDefaults`ä½¿ç”¨

```javascript
<script>
  interface Props {
    name: string
    show: boolean
    labels?: Record<string,any>[]
  }
  const props = withDefaults(defineProps<Props>(), {
    name: 'åŒ–æ°ä¸€å‘³',
    show: false
  })
</script>
```

ä¸Šè¿°ä¸¤ç§æ–¹å¼ï¼Œç›®å‰è¿˜ä¸æ¸…æ¥šå­°ä¼˜å­°åŠ£ï¼Œå…·ä½“çš„è¿˜æ˜¯è¦çœ‹ä¸ªäººå–œå¥½ã€‚å½“ç„¶ä¸ºäº†ä½¿ä»£ç é£æ ¼è¶‹äºç»Ÿä¸€ï¼Œè¿˜æ˜¯é€‰æ‹©å›ºå®šçš„ä¸€ç§æ¨¡å¼æ¯”è¾ƒç¨³å¦¥

## 3.å…³äºå°è£…æ’ä»¶æ–¹å¼ä¸vue2æ–¹å¼çš„åŒºåˆ«

**æ³¨**ï¼šæ‰€è°“çš„æ’ä»¶ï¼Œå°±æ˜¯å°†ä¸€ä¸ªå¸¸ç”¨ç»„ä»¶ä»¥ä¸€ç§å…¨å±€åŒ–çš„æ–¹å¼æš´éœ²ç»™æˆ‘ä»¬çš„ç¨‹åºã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸€ä¸ªtoastå¼¹çª—ç»„ä»¶ï¼Œå¦‚æœä¸ä»¥æ’ä»¶çš„å½¢å¼æš´éœ²ç»™ä½¿ç”¨è€…çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨çš„æ–¹å¼å¾€å¾€æ˜¯å…ˆå¼•å…¥è¯¥ç»„ä»¶ï¼Œç„¶åé€šè¿‡v-if/v-showæ¥æ§åˆ¶è¯¥ç»„ä»¶çš„æ˜¾ç¤ºä¸å¦ï¼Œå½¢å¦‚ï¼š

```javascript
<template>
  <div>
    <Toast v-if="showToast" />
    <button @click="showToast = true">å±•ç¤ºå¼¹çª—</button>
  </div>
</template>

<script>
import Toast from './components/toast.vue'
export default {
  components: {
    Toast
  },
  data() {
    return {
      showToast: false
    }
  }
}
</script>
```

å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºæ¥ï¼Œç»„ä»¶çš„å¸¸è§„åŒ–ä½¿ç”¨æ­¥éª¤æ˜¯ï¼š

- 1.å¼€å‘ç»„ä»¶
- 2.åœ¨éœ€è¦çš„åœ°æ–¹**é‡å¤**å¼•å…¥è¯¥ç»„ä»¶ï¼ˆä¸è€ƒè™‘å…¨å±€æ³¨å†Œç»„ä»¶çš„æ–¹å¼ï¼‰
- 3.é€šè¿‡å˜é‡æ§åˆ¶ç»„ä»¶çš„å±•ç¤ºä¸å¦

å› ä¸ºéœ€è¦é‡å¤çš„å¼•å…¥ï¼Œè¡¨ç°å½¢å¼å¾€å¾€æ¯”è¾ƒå•ä¸€ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½é€šè¿‡ä¸€äº›å…¶ä»–çš„æ–¹å¼ï¼Œå¯ä»¥æ³¨å†Œä¸€æ¬¡ç»„ä»¶ï¼Œåœ¨å¤šä¸ªåœ°æ–¹è°ƒç”¨å‘¢ï¼Ÿï¼ˆä¸æ˜¯æŒ‡Vue.componentå…¨å±€æ³¨å†Œç»„ä»¶ï¼‰ï¼Œè¿™å°±æ˜¯æ’ä»¶çš„æ„ä¹‰å’ŒåŒºåˆ«

### 3.1 Vue2æ³¨å†Œæ’ä»¶æ–¹å¼

```javascript
// popup.js
import Popup from "./popup.vue"

const buildPopupPropData = (
  userOption,defaultOption
) => {
  // æ ¹æ®ç”¨æˆ·æ¯æ¬¡ä½¿ç”¨this.$popupæ–¹æ³•ä¼ å…¥çš„userOptionï¼Œå’Œåˆå§‹åŒ–è¯¥æ’ä»¶æ—¶ä¼ å…¥çš„é»˜è®¤é…ç½®defaultOptionï¼Œåˆå¹¶å¾—å‡ºæœ€ç»ˆçš„é€‰é¡¹ï¼Œæœ€ç»ˆä¼ å…¥ç»„ä»¶ä¸­
  return {
    ...
  }
}

const popupPlugin = {
  install(Vue, defaultOption = {}) {
    const PopupConstructor = Vue.extend(Popup)
    Vue.prototype.$popup = popup

    function popup(userOption) {
      if (!userOption) return
      const propsData = buildPopupPropData(userOption, defaultOption)
      const popupInstance = new PopupConstructor({
        propsData
      })
      document.body.appendChild(popupInstance.$mount().$el)
      popupInstance.show()
    }
  }
}

export default popupPlugin

```

ç„¶ååœ¨ä¸»å…¥å£æ–‡ä»¶ä¸­å¼•å…¥è¯¥popup.jsï¼Œå…¨å±€æ³¨å†Œå³å¯

```javascript
// main.js
import Vue from "vue"
import Popup from './component/popup.js'
...

Vue.use(Popup)

...
```

### 3.2 Vue3æ³¨å†Œæ’ä»¶æ–¹å¼

å®šä¹‰æ’ä»¶æ–¹å¼

```javascript
// toast.ts
import { App, createApp } from 'vue'
import Toast from './toast.vue'

const toastPlugin = {
  install(app: App, defaultOption: Record<string, any> = {}) {
    app.config.globalProperties.$toast = ( // è¿™é‡ŒåŒºåˆ«äºvue2ï¼Œå…¶ä»–é€»è¾‘å·®ä¸å¤š
      message: string,
      customOption: Record<string, any> = {}
    ) => {
      const option = Object.assign({}, defaultOption, customOption)
      const toast = createApp(Toast, {
        message,
        ...option
      })
      const root = document.createElement('div')
      root.classList.add('app-toast')
      document.body.appendChild(root)
      toast.mount(root)
    }
  }
}

export default toastPlugin
```

æ³¨å†Œæ’ä»¶

```javascript
// å…¥å£æ–‡ä»¶
import Toast from './components/toast.ts'
...
app.use(Toast)
...
```

ä½¿ç”¨æ’ä»¶

```javascript
// ä»»æ„ç»„ä»¶ä¸­ï¼Œæƒ³è¦ä½¿ç”¨æ³¨å†Œçš„æ’ä»¶toast
import { getCurrentInstance } from 'vue'

const appInstance = getCurrentInstance()
const { $toast } = appInstance?.appContext.config.globalProperties

$toast('ğŸ˜Šå·²ç»åˆ°åº•äº†')
```

## 4.å¦‚ä½•åŠ¨æ€çš„å¼•å…¥assets/imagesæ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡

å‡è®¾ä¸€ç§åœºæ™¯ï¼Œä¸€ä¸ªç»„ä»¶çš„èƒŒæ™¯å›¾ç‰‡æ˜¯åŠ¨æ€çš„æ ¹æ®ä¼ å…¥çš„propè¿›è¡Œè®¡ç®—å‡ºæ¥çš„(è¿™é‡Œæˆ‘ä»¬åªè€ƒè™‘æœ¬åœ°ç›¸å¯¹è·¯å¾„çš„æ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡)

```javascript
// è·å–assetså›¾ç‰‡é™æ€èµ„æº utils.ts
const getAssetsImageFile = (imgName: string) => {
  return new URL(`../assets/images/${imgName}`, import.meta.url).href
}
export default getAssetsImageFile

```

```javascript
// Demo.vue
<template>
  <div :style="divStyle">hello</div>
</template>

<script setup lang="ts">
import { compouted } from 'vue'
import { getAssetsImageFile } from '@/utils'

const props = defineExpose(['imgName'])

const divStyle = computed(()=>{
  return {
    backgroundImage: `url(${getAssetsImageFile(props.imgName)})`
  }
})
</script>
```







