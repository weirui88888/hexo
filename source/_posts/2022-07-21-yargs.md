---
title: yargs
date: 2022-07-21 19:40:57
tags:
categories:
---

### ä»‹ç»

`yargs`ä¹Ÿå¯ä»¥ç”¨æ¥è·å–å‘½ä»¤è¡Œå‚æ•°ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯å®ƒçš„ä¸»è¦åŠŸèƒ½ã€‚å› ä¸º`yargs`æä¾›å¾ˆå¤šæ¥å£ç”¨æ¥å¸®åŠ©å®Œå–„å‘½ä»¤è¡Œç¨‹åºï¼Œæœ€å¸¸ç”¨çš„å‘½ä»¤æ˜¯ä½¿ç”¨`.commandDir(directory, [opts])`æ¥å‡å°‘ä¸€äº›å­å‘½ä»¤çš„å¼•å…¥è¿‡ç¨‹

<!-- more -->
### ä½¿ç”¨

#### åŸºæœ¬ä½¿ç”¨

```javascript
// index.js
#!/usr/bin/env node
const yargs = require("yargs")
const argv = yargs.help().argv
console.log(argv)
// node index.js -a 10 --b 20 entry -d // { _: [ 'entry' ], a: 10, b: 20, d: true, '$0': 'index.js' }
```
å…³äºä¸Šè¿°ä»£ç çš„ä¸€äº›ç†è§£

- `yargs`é»˜è®¤ä½¿ç”¨ä¸¤ä¸ª`--`ä½œä¸ºå‚æ•°çš„å‰ç¼€ï¼Œä½¿ç”¨`-`å½“ç„¶ä¹Ÿå¯ä»¥ï¼Œä¸­é—´ä½¿ç”¨ç©ºæ ¼æˆ–è€…`=`éƒ½å¯ä»¥
- å¯¹äºæœªè¢«ä½¿ç”¨çš„å‚æ•°ä¼šè¢«å½’ç½®åˆ°`argv._`ä¸­
- å…¶ä¸­æœ‰ä¸ª`$0`å¯ä»¥ç†è§£ä¸ºæ‰§è¡Œå½“å‰è„šæœ¬çš„è·¯å¾„
- å¯¹äºæœªä¼ å‚æ•°çš„é€‰é¡¹ï¼Œä¼šè¢«æŒ‡å®šä¸º`true`


#### æç¤ºç”¨æ³•

```javascript
// index.js
#!/usr/bin/env node
const yargs = require("yargs")

const argv = yargs.usage("Usage: $0 -w [num] -h [num]").help().argv

console.log(argv)
```

ä¸Šè¿°ä½¿ç”¨`usage`ï¼Œå¯ä»¥åœ¨æ‰§è¡Œ`--help`æ—¶å‘Šè¯‰æˆ‘ä»¬ä½¿ç”¨è¯¥è„šæœ¬çš„æ­£ç¡®ä½¿ç”¨æ–¹æ³•ï¼Œå¯¹äºå…¶ä¸­`$0`çš„å«ä¹‰æ¯”è¾ƒæ¨¡ç³Šçš„ï¼Œå¯ä»¥é¿å…ä½¿ç”¨è¯¥å­—æ®µï¼Œå› ä¸ºè¯¥å­—æ®µæœ€ç»ˆä¼šæ¶‰åŠåˆ°`package.json`ä¸­çš„`bin`å­—æ®µã€‚

å½“ç„¶è¿˜æœ‰ä¸€äº›`api`ï¼Œæ¯”å¦‚å®šä¹‰å­—æ®µçš„é»˜è®¤å€¼`.default`ï¼ŒæŒ‡å®šå‚æ•°ä¸ºå¿…å¡«é¡¹`.demand`ç­‰ï¼Œä¸ºæŒ‡å®šå‚æ•°æŒ‡å®šåˆ«å`.alias`ï¼ŒæŒ‡å®šå‚æ•°ä¸ºæ•°ç»„`.array`ç­‰ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹ä½¿ç”¨æ–¹å¼

### è¿›é˜¶

è¯¥åŒ…çš„ä¸»è¦é€‚ç”¨åœºæ™¯ï¼Œå¹¶ä¸æ˜¯é’ˆå¯¹äºè§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯è¿›é˜¶çš„åŸºç¡€å®ç°ï¼ˆæ„æ€å°±æ˜¯ä½¿ç”¨è¿›é˜¶æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è·å–å‚æ•°ï¼‰ã€‚
yargs é€‚åˆå¼€å‘å¤æ‚çš„å‘½ä»¤è¡Œç¨‹åºçš„å¦ä¸€ä¸ªåŸå› æ˜¯å®ƒæ”¯æŒå­å‘½ä»¤ï¼Œè€Œä¸”å­å‘½ä»¤å¯ä»¥åµŒå¥—

#### å­å‘½ä»¤ command

è¯¥å‘½ä»¤æœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ç¬¬ä¸‰ç§ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸‹ç¬¬ä¸€ç§æ–¹å¼å’Œç¬¬ä¸‰ç§æ–¹å¼ï¼Œå…¶å®éƒ½å·®ä¸å¤šï¼Œåªä¸è¿‡ç¬¬ä¸‰ç§æ–¹å¼ï¼ŒæŠŠ module ç‹¬ç«‹å‡ºå»æ–¹ä¾¿ç†è§£å’Œæ”¹åŠ¨

```javascript
.command(cmd, desc, [builder], [handler])

.command(cmd, desc, [module])

.command(module)
```

##### .command(cmd, desc, [builder], [handler])

```javascript
// index.js
#!/usr/bin/env node
const yargs = require("yargs")

const argv = yargs.command(
  "get", // æŒ‡å®šè¿™ä¸ªå­å‘½ä»¤çš„åç§°
  "make a get HTTP request", // å¯¹å­å‘½ä»¤è¿›è¡Œä»‹ç»
  function (yargs) {
    // è¿™é‡Œç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥é…ç½®ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡å³å¯ï¼Œä¹Ÿå¯ä»¥åƒä¸‹é¢æ³¨é‡Šé‚£æ ·é…åˆ¶æˆä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­å¯ä»¥é…ç½®å¾ˆå¤šå‚æ•°ï¼Œå¯ä»¥æŸ¥çœ‹tså®šä¹‰
    return yargs.option("port", {
      alias: "p",
      describe: "è¯·æ±‚çš„ç«¯å£å·",
      string: true,
      default: 8080
    })
  },
  // {
  //   port: {
  //     type: "string",
  //     alias: "p",
  //     describe: "è¯·æ±‚çš„ç«¯å£å·",
  //     default: 8080
  //   }
  // },
  function (argv) {
    console.log(argv)
  }
).argv
```

è¿™ä¸ªæ—¶å€™æ‰§è¡Œä¸‹é¢çš„è„šæœ¬

```javascript
node index.js get --help  // è¿™é‡Œçš„--helpæ˜¯å¯¹getè¿™ä¸ªå­—å‘½ä»¤çš„è§£é‡Šï¼Œå¯ä»¥çœ‹åˆ°ä¼šæŠŠå‚æ•°é€‰é¡¹é»˜è®¤å€¼ã€ç±»å‹ã€å‚æ•°è§£é‡Šæ‰“å°å‡ºæ¥ï¼Œæ–¹ä¾¿ç†è§£å’Œä½¿ç”¨
```

##### .command(module)

```javascript
// module/request.js è¯¥æ–‡ä»¶å¯¼å‡ºå¯¹åº”çš„å››ä¸ªå˜é‡å³å¯
exports.command = "get"

exports.describe = "make a get HTTP request"

exports.builder = {
  port: {
    type: "string",
    alias: "p",
    describe: "è¯·æ±‚çš„ç«¯å£å·",
    default: 8080
  }
}

exports.handler = function (argv) {
  // do something with argv.
}
```

```javascript
// å¼•å…¥çš„æ—¶å€™è¿™æ ·ä½¿ç”¨å³å¯
#!/usr/bin/env node
const yargs = require("yargs")

yargs.command(require('./modules/request.js'))
  .help()
  .argv
```

è¿™ç§æ–¹å¼å¯ä»¥ç†è§£ä¸ºä¸Šé¢ç¬¬ä¸€ç§æ–¹å¼çš„è½¬æ¢å†™æ³•ï¼Œåªä¸è¿‡æˆ‘ä»¬åç»­å¯ä»¥æ·»åŠ æ›´å¤šçš„å­å‘½ä»¤ï¼Œè¿™æ ·æ›´åŠ ä¾¿äºé˜…è¯»å’ŒåæœŸç»´æŠ¤

#### å­å‘½ä»¤ commandDir

_åœ¨é¡¹ç›®å®æˆ˜è¿‡ç¨‹ä¸­ï¼Œå¤§éƒ¨åˆ†ä½¿ç”¨çš„æ˜¯é€šè¿‡è¯¥å‘½ä»¤å°è£…å¤§é‡çš„å­å‘½ä»¤_

å…ˆçœ‹ä¸‹é¡¹ç›®çš„ç›®å½•ç»“æ„

```javascript
â”œâ”€â”€ index.js
â”œâ”€â”€ modules
â”‚   â”œâ”€â”€ query
â”‚   â”‚   â”œâ”€â”€ get.js
â”‚   â”‚   â””â”€â”€ post.js
â”‚   â””â”€â”€ query.js
```

çœ‹ä¸‹æ¯ä¸ªæ–‡ä»¶çš„å†…å®¹

```javascript
// å‘½ä»¤è¡Œå…¥å£æ–‡ä»¶index.js
#!/usr/bin/env node

const yargs = require("yargs")
const path = require("path")
// commandDiré»˜è®¤åªä¼šåŠ è½½ç›®å½•ä¸‹ç¬¬ä¸€çº§çš„æ–‡ä»¶ï¼Œä¸ä¼šé€’å½’åŠ è½½ï¼Œå¦‚æœæƒ³é€’å½’åŠ è½½éœ€è¦è¿™æ ·å†™.commandDir('modules', {recurse: true})
const argv = yargs.commandDir(path.join(__dirname, "modules")).argv
```

```javascript
// modules/query.js
exports.command = "query <command>"

exports.describe = "make a HTTP request with get or port"

exports.builder = function (yargs) {
  return yargs.commandDir("query")
}

exports.handler = function () {}
```

```javascript
// modules/query/get.js
exports.command = "get"

exports.describe = "make a get HTTP request"

exports.builder = {
  port: {
    default: "8080",
    type: "string",
    alias: "p",
    describe: "è¯·æ±‚çš„ç«¯å£å·,é»˜è®¤ä¸º8080"
  },
  host: {
    default: "https://www.baidu.com",
    type: "string",
    alias: "h",
    describe: "è¯·æ±‚çš„åŸŸå,é»˜è®¤ä¸ºhttps://www.baidu.com"
  },
  timeout: {
    default: 5000,
    type: "number",
    alias: "t",
    describe: "è¯·æ±‚çš„è¶…æ—¶æ—¶é—´"
  }
}

exports.handler = function (argv) {
  // do something with argv.
  console.log("ğŸŒ¹ ~ file: get.js ~ line 21 ~ argv", argv)
}
```

```javascript
// modules/query/post.js
exports.command = "post"

exports.describe = "make a post HTTP request"

exports.builder = {
  port: {
    default: "8080",
    type: "string",
    alias: "p",
    describe: "è¯·æ±‚çš„ç«¯å£å·,é»˜è®¤ä¸º8080"
  },
  host: {
    default: "https://www.baidu.com",
    type: "string",
    alias: "h",
    describe: "è¯·æ±‚çš„åŸŸå,é»˜è®¤ä¸ºhttps://www.baidu.com"
  }
}

exports.handler = function (argv) {
  // do something with argv.
  console.log("ğŸŒ¹ ~ file: post.js ~ line 21 ~ argv", argv)
}
```

è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ†åˆ«æ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤ä»è€Œåšä¸åŒçš„åŠ¨ä½œ

```javascript
node index.js query get -p 8000 -h https://www.zhihu.com // è¯¥å‘½ä»¤ä¼šå‘å‡ºä¸€ä¸ªgetè¯·æ±‚ï¼Œhostä¸ºhttps://www.zhihu.comï¼Œç«¯å£å·ä¸º8000ï¼Œè¯·æ±‚è¶…æ—¶æ—¶é—´ä¸º5ç§’
node index.js query port -p 9000 -h https://www.bilibili.com // è¯¥å‘½ä»¤ä¼šå‘å‡ºä¸€ä¸ªpostè¯·æ±‚ï¼Œhostä¸ºhttps://www.bilibili.comï¼Œç«¯å£å·ä¸º9000
```

è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åšåˆ°å°è£…ä»»æ„å¤šä¸ªå­å‘½ä»¤è€Œä¿æŒæˆ‘ä»¬çš„ä»£ç æ›´åŠ çš„ç®€æ´ï¼Œä¹Ÿæ›´åŠ çš„å®¹æ˜“é˜…è¯»å’Œç»´æŠ¤

### æ€»ç»“

æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›å¥½ç”¨çš„åŒ…ï¼Œç»“åˆè‡ªå·±é¡¹ç›®çš„ä¸€äº›åœºæ™¯ï¼Œå°è£…ä¸€äº›å‘½ä»¤æ¥å®ç°å¿«é€Ÿçš„å®Œæˆä¸€äº›ä»»åŠ¡ï¼Œå…¶ä¸­æœ‰ä¸ªåœºæ™¯ï¼Œå°±æ˜¯å‡è®¾æˆ‘å¸çš„é¡¹ç›®æ˜¯ä¸€ä¸ªå¤šé¡µé¢çš„ç»“æ„ï¼Œæœªæ¥ç”Ÿæˆçš„é¡µé¢ä¼šæœ‰å¤šä¸ªè·¯å¾„ã€‚è€Œè¿™äº›è·¯å¾„å‡è®¾æˆ‘ä»¬åœ¨å¦å¤–ä¸€ä¸ªé¡¹ç›®ä¸­è¦é¢‘ç¹ç”¨åˆ°çš„è¯ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥å†™ä¸€ä¸ªè„šæœ¬å·¥å…·ï¼Œä»è€Œç»“åˆ node çš„ io èƒ½åŠ›è‡ªåŠ¨ç”Ÿæˆé¡¹ç›®çš„ä¸åŒè·¯å¾„ã€‚

### å‚è€ƒ

[ä»é›¶å¼€å§‹æ‰“é€ ä¸ªäººä¸“å±å‘½ä»¤è¡Œå·¥å…·é›†â€”â€”yargs å®Œå…¨æŒ‡å—](https://segmentfault.com/a/1190000006227402)
